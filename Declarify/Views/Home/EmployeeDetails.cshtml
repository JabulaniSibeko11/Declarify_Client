@model Declarify.Models.ViewModels.EmployeeDetailsViewModel

@{
    ViewData["Title"] = $"{Model.Employee.Full_Name} - Employee Profile";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] - Declarify</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="~/css/admindashboardcss.css" rel="stylesheet" />

    <style>
        /* Minor enhancements to existing CSS for this page */
        .profile-hero {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }

        .large-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: white;
            color: var(--color-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 800;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
        }

        .compliance-highlight {
            background: rgba(255,255,255,0.15);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .team-card {
            background: white;
            border: 2px solid var(--color-border);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s;
        }

            .team-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 10px 30px rgba(0,194,203,0.15);
                border-color: var(--color-accent);
            }

        .team-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--color-accent);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <header class="modern-header">
        <div class="header-container">
            <div class="header-left">
                <div class="brand-section">
                    <div class="brand-logo">
                        <div class="logo-circle"></div>
                        <div class="brand-text">
                            <div class="brand-name">Declar</div>
                            <div class="brand-tagline">Compliance Hub</div>
                        </div>
                    </div>
                    <div class="vertical-divider"></div>
                    <div class="company-badge">
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
                            <polyline points="9 22 9 12 15 12 15 22" />
                        </svg>
                        <span>CPT</span>
                    </div>
                </div>
            </div>

            <div class="header-center">
                <div class="dashboard-breadcrumb">
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <rect x="3" y="3" width="7" height="7" />
                        <rect x="14" y="3" width="7" height="7" />
                        <rect x="14" y="14" width="7" height="7" />
                        <rect x="3" y="14" width="7" height="7" />
                    </svg>
                    <a href="@Url.Action("Index", "Home")">Dashboard</a> >
                    <a href="@Url.Action("Employees", "Home")">Employees</a> >
                    <span>@Model.Employee.Full_Name</span>
                </div>
            </div>

            <div class="header-right">
                <button class="employee-trigger">
                    <div class="employee-avatar">AM</div>
                    <div class="employee-info-compact">
                        <div class="employee-name">Alice Morgan</div>
                        <div class="employee-role">
                            <span class="role-badge">Admin</span>
                            <span class="employee-id">#A-001</span>
                        </div>
                    </div>
                    <svg class="dropdown-arrow" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <polyline points="6 9 12 15 18 9" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <main>
        <!-- Profile Hero -->
        <div class="hero-banner profile-hero">
            <div class="hero-content" style="max-width: 1200px; margin: 0 auto; padding: 0 2rem;">
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 2rem;">
                    <div style="display: flex; align-items: center; gap: 2rem;">
                        <div class="large-avatar">
                            @(string.IsNullOrEmpty(Model.Employee.Full_Name) ? "EE" : Model.Employee.Full_Name.Substring(0, Math.Min(2, Model.Employee.Full_Name.Length)).ToUpper())
                        </div>
                        <div>
                            <h1 style="margin: 0; font-size: 2.5rem;">@Model.Employee.Full_Name</h1>
                            <p style="margin: 0.5rem 0 0; font-size: 1.25rem; opacity: 0.9;">
                                @Model.Employee.Position • @Model.Employee.Department
                            </p>
                        </div>
                    </div>

                    <div class="compliance-highlight">
                        <div class="stat-label" style="font-size: 1rem; opacity: 0.8;">Overall Compliance Rate</div>
                        <div class="stat-value" style="font-size: 3rem; margin: 0.5rem 0;">@Model.ComplianceRate.ToString("F1")%</div>
                        <div class="stat-progress" style="height: 12px; background: rgba(255,255,255,0.2); border-radius: 6px;">
                            <div class="stat-progress-bar" style="width: @Model.ComplianceRate%; background: white; height: 100%; border-radius: 6px;"></div>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.9rem;">
                            @(Model.ComplianceRate >= 95 ? "🎉 Goal Achieved!" : $"{(95 - Model.ComplianceRate):F1}% to goal")
                        </div>
                    </div>
                </div>

                <div class="hero-actions" style="margin-top: 2rem;">
                    <button class="btn btn-primary" onclick="location.href='@Url.Action("BulkRequest", "Home", new { employeeIds = new int[] { Model.Employee.EmployeeId } })'">
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M12 4v16m8-8H4" />
                        </svg>
                        Assign New DOI
                    </button>
                    <button class="btn btn-ghost">
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                        Edit Profile
                    </button>
                </div>
            </div>
        </div>

        <!-- Quick Info Grid -->
        <div class="stats-grid" style="max-width: 1200px; margin: 0 auto 3rem; padding: 0 2rem;">
            <div class="stat-card">
                <div class="stat-header"><div class="stat-icon">🆔</div></div>
                <div class="stat-label">Employee ID</div>
                <div class="stat-value">@Model.Employee.EmployeeNumber</div>
            </div>
            <div class="stat-card">
                <div class="stat-header"><div class="stat-icon">📧</div></div>
                <div class="stat-label">Email Address</div>
                <div class="stat-value">@Model.Employee.Email_Address</div>
            </div>
            <div class="stat-card">
                <div class="stat-header"><div class="stat-icon">🏢</div></div>
                <div class="stat-label">Department</div>
                <div class="stat-value">@Model.Employee.Department</div>
            </div>
            <div class="stat-card">
                <div class="stat-header"><div class="stat-icon">📅</div></div>
                <div class="stat-label">Date Joined</div>
                <div class="stat-value">Not available</div> <!-- Add if you have this field -->
            </div>
        </div>

        <!-- Compliance History -->
        <div class="section" style="max-width: 1200px; margin: 0 auto 3rem; padding: 0 2rem;">
            <div class="section-header">
                <h2 class="section-title">DOI Compliance History (@Model.Tasks.Count tasks)</h2>
                <button class="btn btn-ghost">
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    Export History
                </button>
            </div>

            @if (!Model.Tasks.Any())
            {
                <div class="empty-state" style="text-align: center; padding: 4rem 0;">
                    <svg width="100" height="100" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" style="margin: 0 auto 1rem;">
                        <path d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <h3>No DOI tasks assigned yet</h3>
                    <p>This employee has not been assigned any Declaration of Interest forms.</p>
                </div>
            }
            else
            {
                <div class="table-container">
                    <table class="employee-selection-table">
                        <thead>
                            <tr>
                                <th>Form Template</th>
                              @*   <th>Assigned</th> *@
                                <th>Due Date</th>
                               @*  <th>Submitted</th> *@
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var task in Model.Tasks.OrderByDescending(t => t.DueDate))
                            {
                                var statusClass = task.Status.ToLower() switch
                                {
                                    "completed" or "reviewed" => "success",
                                    "overdue" => "danger",
                                    "pending" or "outstanding" => "warning",
                                    _ => ""
                                };

                                <tr>
                                    <td><strong>@task.Template</strong></td>
                                  @*   <td>@task.AssignedDate.ToString("MMM dd, yyyy")</td> *@
                                    <td>@task.DueDate.ToString("MMM dd, yyyy")</td>
                                  @*   <td>@(task.SubmissionDate?.ToString("MMM dd, yyyy") ?? "—")</td> *@
                                    <td><span class="status-badge @statusClass">@task.Status</span></td>
                                    <td>
                                        <a href="@Url.Action("ViewSubmission", "Home", new { taskId = task.TaskId })" class="btn-action">
                                            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                                                <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                                <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                            </svg>
                                            View
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>

        <!-- Team / Subordinates -->
        <div class="section" style="max-width: 1200px; margin: 0 auto; padding: 0 2rem;">
            <div class="section-header">
                <h2 class="section-title">Direct Reports (@Model.Subordinates.Count)</h2>
                <button class="btn btn-primary" onclick="location.href='@Url.Action("BulkRequest", "Home", new { employeeIds = Model.Subordinates.Select(s => s.EmployeeId).ToArray() })'">
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M12 4v16m8-8H4" />
                    </svg>
                    Assign DOI to Team
                </button>
            </div>

            @if (!Model.Subordinates.Any())
            {
                <div class="empty-state" style="text-align: center; padding: 3rem 0;">
                    <p>No direct reports assigned to this employee.</p>
                </div>
            }
            else
            {
                <div class="team-grid">
                    @foreach (var sub in Model.Subordinates)
                    {
                        // Placeholder compliance rate - replace with real calculation if available
                        double subCompliance = 88.5; // Example

                        <div class="team-card">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div class="team-avatar">
                                    @(sub.Full_Name?.Substring(0, Math.Min(2, sub.Full_Name?.Length ?? 0)).ToUpper() ?? "EE")
                                </div>
                                <div>
                                    <div style="font-weight: 700; font-size: 1.1rem;">@sub.Full_Name</div>
                                    <div style="color: var(--color-text-muted);">@sub.Position</div>
                                </div>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <span style="font-size: 0.9rem; opacity: 0.8;">Compliance Rate</span>
                                <div style="font-weight: 700; font-size: 1.5rem;">@subCompliance.ToString("F1")%</div>
                                <div class="stat-progress small" style="height: 8px; margin-top: 0.5rem;">
                                    <div class="stat-progress-bar" style="width: @subCompliance%;"></div>
                                </div>
                            </div>
                            <a href="@Url.Action("EmployeeDetails", "Home", new { id = sub.EmployeeId })" class="btn-action" style="width: 100%; text-align: center;">
                                View Profile
                            </a>
                        </div>
                    }
                </div>
            }
        </div>
    </main>
</body>
</html>