@model Declarify.Models.ViewModels.InitialPasswordSetupViewModel
@{
    ViewData["Title"] = "Initial Account Setup";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] - Declarify</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    

    <link href="~/css/initialpage.css" rel="stylesheet" />
</head>
<body>
    <!-- Background Orbs -->
    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>
    <div class="bg-orb orb-3"></div>

    <!-- Modal Overlay -->
    <div class="modal-overlay">
        <div class="setup-modal">
            <!-- Accent Bar -->
            <div class="accent-bar"></div>

            <!-- Modal Header with Declarify Logo -->
            <div class="modal-header">
                <div class="declarify-logo">
                    <div class="logo-shape"></div>
                    <div class="logo-checkmark">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                </div>
                <h1 class="modal-title">
                    Welcome to <span class="brand-name">Declarify</span>
                </h1>
                <p class="modal-subtitle">Complete your account setup to get started</p>
            </div>

            <!-- Modal Content -->
            <div class="modal-content">
                <!-- Welcome Message -->
                <div class="welcome-message">
                    <h3>Hello, @Model.FullName!</h3>
                    <p>Set your secure password and capture your digital signature. Your signature will be used for all official declarations and compliance documents.</p>
                </div>

                <!-- Progress Steps -->
                <div class="progress-steps">
                    <div class="step active" id="step1"></div>
                    <div class="step" id="step2"></div>
                </div>

                <!-- Validation Summary -->
                @if (!ViewData.ModelState.IsValid)
                {
                    <div class="validation-summary">
                        <h4>Please correct the following errors:</h4>
                        <ul>
                            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                            {
                                <li>@error.ErrorMessage</li>
                            }
                        </ul>
                    </div>
                }

                <!-- Form -->
                <form asp-action="InitialSetup" method="post" id="setupForm">
                    <input type="hidden" asp-for="Email" />
                    <input type="hidden" asp-for="Token" />
                    <input type="hidden" asp-for="SignatureData" id="signatureDataInput" />

                    <!-- Step 1: Password Setup -->
                    <div id="passwordStep">
                        <!-- Password -->
                        <div class="form-group">
                            <label class="form-label" asp-for="Password">
                                New Password <span class="required">*</span>
                            </label>
                            <input type="password" 
                                   asp-for="Password" 
                                   class="form-input" 
                                   id="passwordInput"
                                   placeholder="Enter a strong password" />
                            <span asp-validation-for="Password" class="form-error"></span>
                            
                            <!-- Password strength indicator -->
                            <div class="password-strength">
                                <div class="strength-bar">
                                    <div class="strength-fill" id="strengthFill"></div>
                                </div>
                                <span class="strength-text" id="strengthText"></span>
                            </div>
                            
                            <div class="form-help">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M12 16v-4M12 8h.01"></path>
                                </svg>
                                Must contain uppercase, lowercase, number, and special character
                            </div>
                        </div>

                        <!-- Confirm Password -->
                        <div class="form-group">
                            <label class="form-label" asp-for="ConfirmPassword">
                                Confirm Password <span class="required">*</span>
                            </label>
                            <input type="password" 
                                   asp-for="ConfirmPassword" 
                                   class="form-input" 
                                   placeholder="Re-enter your password" />
                            <span asp-validation-for="ConfirmPassword" class="form-error"></span>
                        </div>

                        <button type="button" class="btn-primary" id="nextToSignature">
                            Continue to Signature
                        </button>
                    </div>

                    <!-- Step 2: Signature Capture -->
                    <div id="signatureStep" style="display: none;">
                        <div class="signature-section">
                            <h3>
                                <svg class="signature-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                                    <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                                    <path d="M2 2l7.586 7.586"></path>
                                    <circle cx="11" cy="11" r="2"></circle>
                                </svg>
                                Your Digital Signature
                            </h3>
                            <p class="form-help" style="margin-bottom: 16px;">
                                Sign below using your mouse, touchpad, or finger (on touch devices)
                            </p>
                            
                            <div class="canvas-wrapper" id="canvasWrapper">
                                <canvas id="signatureCanvas"></canvas>
                                <div class="signature-placeholder" id="signaturePlaceholder">
                                    ✍️ Sign here
                                </div>
                            </div>

                            <div class="signature-actions">
                                <button type="button" class="btn-secondary" id="clearSignature">
                                    Clear
                                </button>
                                <button type="button" class="btn-secondary" id="backToPassword">
                                    Back
                                </button>
                            </div>
                        </div>

                        <button type="submit" class="btn-primary" id="submitButton" disabled>
                            Complete Setup
                        </button>
                    </div>
                </form>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <svg class="footer-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 16v-4M12 8h.01"></path>
                </svg>
                <span>Public Sector Integrity. Clarified.</span>
            </div>
        </div>
    </div>
    <script src="~/js/initialpage.js"></script>
  
 </body>
 </html>
     