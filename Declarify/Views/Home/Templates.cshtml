@model Declarify.Models.ViewModels.TemplateManagementViewModel

@{
    ViewData["Title"] = "Template Management";
    Layout = null;
}

<link href="~/css/managetemplate.css" rel="stylesheet" />

<div class="page-header">
    <div class="header-content">
        <h1 class="header-title">
            <svg width="44" height="44" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            Template Management
        </h1>
        <p class="header-subtitle">Create, configure, and manage your Declaration of Interest form templates</p>
    </div>
</div>

<div class="content-container">
    <div class="control-panel">
        <div class="search-box">
            <svg class="search-icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                <circle cx="11" cy="11" r="8" />
                <path d="m21 21-4.35-4.35" />
            </svg>
            <input type="text" id="searchInput" placeholder="Search templates..." />
        </div>

        <div class="filter-section">
            <button class="filter-pill active" data-filter="all">All</button>
            <button class="filter-pill" data-filter="active">Active</button>
            <button class="filter-pill" data-filter="draft">Draft</button>
            <button class="filter-pill" data-filter="archived">Archived</button>
        </div>

        <a href="@Url.Action("CreateTemplate")" class="btn-primary">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
                <path d="M12 5v14m7-7H5" />
            </svg>
            Create Template
        </a>
    </div>

    @if (Model.Templates == null || !Model.Templates.Any())
    {
        <div class="empty-state">
            <svg width="120" height="120" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <path d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <h3>No Templates Yet</h3>
            <p>Get started by creating your first Declaration of Interest template</p>
            <a href="@Url.Action("CreateTemplate")" class="btn-primary">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
                    <path d="M12 5v14m7-7H5" />
                </svg>
                Create Your First Template
            </a>
        </div>
    }
    else
    {
        <div class="table-container">
            <table id="templatesTable">
                <thead>
                    <tr>
                        <th style="width: 35%;">Template</th>
                        <th style="width: 15%;">Status</th>
                        <th style="width: 20%;">Created Date</th>
                        <th style="width: 30%;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var template in Model.Templates)
                    {
                        var statusClass = template.Status.ToLower();
                        <tr data-status="@statusClass">
                            <td>
                                <div class="template-name">@template.TemplateName</div>
                                <div class="template-description">
                                    @(string.IsNullOrEmpty(template.Description) ? "No description provided" : template.Description)
                                </div>
                            </td>
                            <td>
                                <span class="status-badge @statusClass">@template.Status</span>
                            </td>
                            <td>
                                <div class="date-cell">
                                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                        <path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                    </svg>
                                    <span>@template.CreatedDate.ToString("MMM dd, yyyy")</span>
                                </div>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <a href="@Url.Action("EditTemplate", new { id = template.TemplateId })" class="btn-action">
                                        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                                            <path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                        </svg>
                                        Edit
                                    </a>

                                    @if (template.Status.ToLower() == "draft")
                                    {
                                        <form method="post" action="@Url.Action("PublishTemplate", new { id = template.TemplateId })" style="display: inline;">
                                            @Html.AntiForgeryToken()
                                            <button type="submit" class="btn-action success">
                                                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                                                    <path d="M5 13l4 4L19 7" />
                                                </svg>
                                                Publish
                                            </button>
                                        </form>
                                    }

                                    @if (template.Status.ToLower() == "active")
                                    {
                                        <form method="post" action="@Url.Action("ArchiveTemplate", new { id = template.TemplateId })" style="display: inline;">
                                            @Html.AntiForgeryToken()
                                            <button type="submit" class="btn-action warning">
                                                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                                                    <path d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                                                </svg>
                                                Archive
                                            </button>
                                        </form>
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

@section Scripts {
    <script>
        // Filter functionality
        document.querySelectorAll('.filter-pill').forEach(pill => {
            pill.addEventListener('click', function() {
                document.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('active'));
                this.classList.add('active');

                const filter = this.dataset.filter;
                const rows = document.querySelectorAll('#templatesTable tbody tr');

                rows.forEach(row => {
                    if (filter === 'all' || row.dataset.status === filter) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
        });

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('#templatesTable tbody tr');

            rows.forEach(row => {
                const name = row.querySelector('.template-name').textContent.toLowerCase();
                const description = row.querySelector('.template-description').textContent.toLowerCase();

                if (name.includes(searchTerm) || description.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // Confirmation for publish/archive actions
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function(e) {
                const button = this.querySelector('button[type="submit"]');
                const action = button.textContent.trim();

                if (!confirm(`Are you sure you want to ${action.toLowerCase()} this template?`)) {
                    e.preventDefault();
                }
            });
        });
    </script>
}